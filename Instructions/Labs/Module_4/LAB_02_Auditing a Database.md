

# モジュール 4：データベースの監査

## 演習 1：データベースの監査を有効にする

### タスク 1：ラボの設定

1.  **PowerShell** を開き、次のコマンドを実行して、ラボ用のデータベースをデプロイします。

     ```powershell
    start "https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FMicrosoftLearning%2FAZ-500-Azure-Security%2Fmaster%2FAllfiles%2FLabs%2FMod4_Lab02%2Fazuredeploy.json" 
     ```

1.  **リソース グループ** で、[新規作成] をクリックし、デフォルト名「**Mod4Lab2**」を使用する

1.  デフォルトの設定済み SQL サーバー名を使用できる

1.  **購入** をクリックする
警告
**注記**：テストデータを含む SQLデータベースがデプロイするのを待機する必要がある

### タスク 2：データベースの監査を有効にする

1.  ラボのセットアップで作成したリソース グループを選択する

2.  SQL サーバー **az500labserver2** を **選択** します。

3.  **セキュリティ** で、**監査** を選択し、

4.  **監査の切り替え** を **オン** にします。

5.  監査ログを送信する場所としてストレージを選択する

6.  **構成をクリックする**

7.  **サブスクリプション** を選択する

8.  **新規作成をクリックします**。

9.  サブスクリプションに「**mod4lab2YOURNAME**」という名前を付けて、一意の名前を作成する

10. **OK をクリックします**。

11. リテンション日数を **5** に変更してから、**OK** をクリックする 

12. **保存** をクリックして、**監査構成** を保存する

## 演習 2：監査ログをレビューする

### タスク 1：SQL DB の監査ログをレビューします。

1.  データベースの監査ログを確認するには、ラボのセットアップで作成されたリソース グループに戻る

1.  **AZ500LabDb（az500labserver2/AZ500LabDb）** をクリックして、テストデータベースを選択する

1.  **監査** をクリックする
警告
**注意**：監査はここではオフに見えるが、基になるサーバー レベルで設定されているため、このデータベースに対してオンになっている


1.  **監査ログ** の表示を **クリック** します。
警告
**注意**：これは、試行された SQL インジェクションを含む Db の監査ログの出力を確認する場所です。これは、ログの前に作成されたテストデータベースであるため、現在のログにある場合は最小限の監査になります。
サーバーの監査が有効になっている場合、データベース構成監査とサーバー監査が並行して存在します
監査ログを書き込む場所を選択できます。ログは、Azure ストレージ アカウント、 Log Analytics ワークスペース (Azure Monitor ログで使用)、イベント ハブ (イベント ハブで使用) に書き込むことができます。これらのオプションは組み合わせて構成でき、それぞれの場所に監査ログが書き込まれます。



**結果**：SQL データベースで監査をセットアップし、監査出力を表示する場所を確認した
