---
lab:
    title: 'ラボ 1 - モニターとオートスケール'
    module: 'モジュール 2 - プラットフォーム保護を実装する'
---

# モジュール 2：ラボ 1 - モニターとオートスケール


オートスケールは、Azure クラウドサービス、モバイルサービス、仮想マシン、および Web サイトの組み込み機能で、需要の変化に応じてアプリケーションが最高のパフォーマンスを発揮するのに役立ちます。もちろん、パフォーマンスはアプリケーションごとに異なります。CPU にバインドされているアプリもあれば、メモリにバインドされているアプリもあります。たとえば、日中は何百万ものリクエストを処理し、夜間は何も処理しない Web アプリを作成できます。自動スケールは、これらのいずれかまたは定義したカスタムメトリックによってサービスをスケーリングできます。


## 演習 1：ラボの設定

1.  PowerShell を開いて、次のコマンドを実行します。

     ```powershell
    start "https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FMicrosoftLearning%2FAZ-500-Azure-Security%2Fmaster%2FAllfiles%2FLabs%2FMod2_Lab01%2Ftemplate.json"
     ```

    *これにより、テンプレートから新しいアプリとアプリサービスプランが展開され、AZ500 Mod2 Lab 1 のスケールアップオプションのデモに使用できます。*

1.  **新しいリソース グループの作成** を選択します  

1.  **サイト名** と **サービスプラン** に対して **一意な** 名前を入力します。 

1.  利用規約に同意して購入をクリックします

## 演習 2：最初のオートスケール設定を作成する


最初の自動スケール設定を作成するための簡単なステップバイステップのウォークスルーを見てみましょう。


1.  Azure Monitor で、**オートスケール** ブレードを開き、スケーリングするリソースを選択します。セットアップ中に作成したアプリサービスプランを選択できます
1.  現在のインスタンス数は 1 であることに注意してください。**オートスケールを有効にする** をクリックします。

1.  スケール設定の名前を指定して、**ルールを追加する** をクリックします。 

1.  右側のコンテキスト ペインとして開くスケール ルール オプションに注意してください。デフォルトでは、これにより、リソースの CPU パーセンテージが 70％ を超える場合にインスタンス カウントを 0 だけスケーリングするオプションが設定されます。デフォルト値のままにして、**追加** をクリックします。

1.  これで、最初のスケールルールが作成されました。UX はベスト プラクティスを推奨し、「少なくとも 1 つのスケールをルールに含めることをお勧めします」と述べていることに注意してください。そうするには：

    - **ルールを追加する** をクリックします。

    - **オペレーター** を **未満** に設定します。

    - **しきい値** を **20** に設定します。

    - **操作** を **カウントを減らす** に設定します。

1.  **追加** をクリックします。

1.  [**保存**] をクリックします。


**お疲れ様でした**！これで、CPU 使用率に基づいて Web アプリを自動スケーリングする最初のスケール設定が正常に作成されました。


## 演習 3：スケジュールに基づいたスケール


CPU に基づくスケールに加えて、特定の曜日に異なるスケールを設定できます。


1.  **スケール条件を追加する** をクリックします。

1.  スケールモードとルールの設定は、デフォルトの条件と同じです。
1.  そのスケジュールについて **特定の曜日を繰り返す** を選択します。
1.  スケール条件を適用する曜日と開始/終了時間を選択します。


## 演習 4：特定の日付によって異なるスケール


CPU に基づいたスケールに加えて、特定の日付に対して異なるスケールを設定できます。


1.  **スケール条件を追加する** をクリックします。

1.  スケールモードとルールの設定は、デフォルトの条件と同じです。
1.  そのスケジュールについて **開始日/終了日を指定する** を選択します。
1.  スケール条件を適用する開始/終了日と開始/終了時間を選択します。



## 演習 5：  リソースのスケール履歴を表示する

1.  リソースが拡大または縮小されるたびに、イベントがアクティビティログに記録されます。**実行履歴** タブに切り替えることにより、過去 24 時間のリソースのスケール履歴を表示できます。

1.  完全なスケール履歴を表示する場合（最大 90 日間）、**詳細を見るにはここをクリックしてください** を選択します。アクティビティログが開き、リソースとカテゴリの自動スケールが事前に選択されています。

## 演習 6：リソースのスケール定義を表示します

1.  自動スケーリングは、Azure Resource Manager リソースです。JSON でスケール定義を表示するには、 **JSON** タブに切り替えます。

1.  必要に応じて直接、**JSON** で変更を加えることができます。これらの変更は、保存後に反映されます。


| 警告：続行する前に、このラボで使用したすべてのリソースを削除する必要があります。  **Azure Portal** でこれを行うには、**リソース グループ** をクリックします。  作成したリソース グループを選択します。  リソース グループ ブレードで、**リソース グループを削除** をクリックし、リソース グループ名を入力して、**削除** をクリックします。  作成した可能性のある追加のリソース グループに対してプロセスを繰り返します。**これを行わないと、他のラボで問題が発生する可能性があります。** |
| --- |


**結果**：これで、このラボを完了しました。
