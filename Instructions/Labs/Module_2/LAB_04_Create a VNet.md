---
lab:
    title: 'ラボ 4 - VNet を作成する'
    module: 'モジュール 2 - プラットフォーム保護を実装する'
---

# モジュール 2：ラボ 4 - VNet を作成する


**シナリオ**

このモジュールでは、Azure 仮想ネットワークの内容を紹介します。仮想ネットワークとは何で、それらはどのように整理されていますか？テンプレート、PowerShell、CLI、またはAzure portal を使用して仮想ネットワークを作成および構成するにはどうすればよいですか？パブリック IP アドレス、プライベート IP アドレス、静的 IP アドレス、動的 IP アドレスの違いは何ですか？システム ルート、ルーティング テーブル、ルーティング アルゴリズムはどのように使用されますか？次のレッスンが含まれます。

- Virtual Network の導入
- Azure Virtual Network の作成
- IP アドレッシングのレビュー


## 演習 1：Azure portal を使用して、仮想ネットワークを作成する


**シナリオ**

仮想ネットワークは、Azure のプライベート ネットワークの基本的な構成要素です。これにより、仮想マシン（VM）などの Azure リソースが相互に、およびインターネットと安全に通信できるようになります。このラボでは、Azure portal を使用して仮想ネットワークを作成する方法を学習します。次に、2つの VM を仮想ネットワークにデプロイし、2つの VM 間で安全に通信し、インターネットから VM に接続できます。


### タスク 1：仮想ネットワークを作成する

1.  画面の左上隅で、**リソースの作成** > **ネットワーク** > **仮想ネットワーク** を選択します。

1.  **仮想ネットワークの作成** で、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | *myVirtualNetwork* と入力します。 |
    | アドレス空間 | *10.1.0.0/16* と入力します。 |
    | サブスクリプション | サブスクリプションを選択します。|
    | リソース グループ | **新規作成** を選択し、*myResourceGroup* と入力し、**OK** を選択します。 |
    | 保存先 | **米国東部** と入力します。|
    | サブネット - 名前 | *myVirtualSubnet* と入力します。 |
    | サブネット - アドレス範囲 | *10.1.0.0/24* と入力します。 |

1.  残りの既定値はそのままにして、**作成** を選択します。

### タスク 2：仮想マシンを作成する


仮想ネットワークに 2 つの VM を作成します。


1.  画面の左上にある **リソースの作成** > **コンピューティング** > **Windows Server 2019 Datacenter** を選択します。

1.  **「仮想マシンの作成 - 基本」** で、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | **プロジェクトの詳細** | |
    | サブスクリプション | サブスクリプションを選択します。 |
    | リソース グループ | **myResourceGroup** を選択します。前のセクションで作成しました。 |
    | **インスタンスの詳細** |  |
    | 仮想マシン名 | *myVm1* と入力します。 |
    | リージョン | **米国東部** と入力します。 |
    | 可用性オプション | 既定値の **インフラストラクチャ冗長は必要ありません** のままにします。 |
    | イメージ | 既定の **Windows Server 2019 Datacenter** のままにします。 |
    | サイズ | 既定の **Standard DS1 v2** のままにします。 |
    | **管理者アカウント** |  |
    | ユーザー名 | 選択したユーザー名を入力します。 |
    | パスワード | Pa55w.rd1234 |
    | パスワードを確定する | パスワードを再入力します。 |
    | **受信ポート ルール** |  |
    | パブリック受信ポート | 既定の **None** のままにします |
    | **コストを削減** |  |
    | 既に Windows ライセンスをお持ちですか?  | 既定の **いいえ** のままにします |

1.  **「次へ : ディスク」** を選択します。

1.  **「仮想マシンの作成 - ディスク」** を既定値のままにして、**「次へ : 「ネットワーク」** を選択します。

1.  **「仮想マシンの作成 - ネットワーク」** で、次の情報を選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | 仮想ネットワーク | 既定の **myVirtualNetwork** のままにします。 |
    | サブネット | 既定の **myVirtualSubnet (10.1.0.0/24)** のままにします |
    | パブリック IP | 既定の **(新しい) myVm-ip** のままにします |
    | パブリック受信ポート | **「選択したポートを許可する」** を選択します。 |
    | 受信ポートを選択する | **HTTP** と **RDP** を選択します。

1.  **Next :** を選択します **管理** を選択します。

1.  **「仮想マシンの作成 - 管理」** で、**「診断ストレージ アカウント」** に **「新規作成」** を選択します。

1.  **「ストレージ アカウントの作成」** で、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | *myvmstorageaccount* と入力します。この名前を使用する場合は、一意の名前を作成してください。|
    | アカウントの種類 | 既定値 **ストレージ (汎用 v1)** のままにします。 |
    | パフォーマンス | 既定の **標準** のままにします。 |
    | レプリケーション | 既定の **ローカル冗長ストレージ (LRS)** のままにしておきます。 |

1.  **OK** を選択します。

1.  **「確認および作成」** を選択します。**「確認および作成」** ページが表示され、Azure が構成を検証します。

1.  **検証が成功した** ことを示すメッセージを確認したら、**作成** を選択します。

### タスク 3：  2 つ目の VM を作成する

1.  上記の手順 1 と 9 を完了します。

    **注記**：手順 2 では、**仮想マシン名** に *myVm2* と入力します。  手順 7 では、**診断ストレージ アカウント** の場合は、**myvmstorageaccount** を選択していることを確認します。


1.  **「確認および作成」** を選択します。**「確認および作成」** ページが表示され、Azure が構成を検証します。

1.  **検証が成功した** ことを示すメッセージを確認したら、**作成** を選択します。

### タスク 4：  インターネットから VM に接続する


*myVm1* を作成したら、インターネットに接続します。


1.  ポータルの検索バーに *myVm1* と入力します。

1.  **接続** ボタンを選択します。


    **「接続」** ボタンを選択すると、**「仮想マシンに接続」** が開きます。

1.  **「RDP ファイルのダウンロード」** を選択します。Azure はリモート デスクトップ プロトコル (*.rdp*) ファイルを作成し、コンピュータにダウンロードします。

1.  ダウンロードした *rdp* ファイルを開きます。

    1. プロンプトが表示された場合は、**「接続」** を選択します。

    1. VM の作成時に指定したユーザー名とパスワードを入力します。

    **注記**：VM 作成時に入力した資格情報を指定するには、**その他** > **別のアカウントを使用する** を選択する必要があります。


1.  **OK** を選択します。

1.  サインイン プロセス中に証明書の警告が表示されることがあります。証明書の警告が表示された場合は、**はい** または **続行** を選択します。

1.  VM デスクトップが表示されたら、最小化してローカル デスクトップに戻ります。

### タスク 5：VM 間の通信

1.  *myVm1* のリモート デスクトップで PowerShell  を開きます。

1.  「ping myVm2」 と入力します。

    次のようなメッセージが表示されます。

    ```powershell
    Pinging myVm2.0v0zze1s0uiedpvtxz5z0r0cxg.bx.internal.clouda
    Request timed out.
    Request timed out.
    Request timed out.
    Request timed out.

    Ping statistics for 10.1.0.5:
    Packets: Sent = 4, Received = 0, Lost = 4 (100% loss),
    ```

    「ping」ではインターネット制御メッセージ プロトコル (ICMP) が使用されるため、「ping」は失敗します。既定で、ICMP は Windows ファイアウォールを通過できません。

1.  *myVm2* が後の手順で *myVm1* に ping を実行できるようにするには、次のコマンドを入力します。

    ```powershell
    New-NetFirewallRule -DisplayName "Allow ICMPv4-In" -Protocol ICMPv4
    ```

    このコマンドを使用すると、Windows ファイアウォール経由の ICMP の受信が許可されます。

1.  *myVm1* へのリモート デスクトップ接続を閉じます。

1.  上記の **インターネットから VM に接続** する手順をもう一度実行しますが、*myVm2* に接続します。

1.  コマンド プロンプトから、「ping myvm1」と入力します。

    次のようなメッセージが表示されます。

    ```powershell
    Pinging myVm1.0v0zze1s0uiedpvtxz5z0r0cxg.bx.internal.cloudapp.net [10.1.0.4] with 32 bytes of data:
    Reply from 10.1.0.4: bytes=32 time=1ms TTL=128
    Reply from 10.1.0.4: bytes=32 time<1ms TTL=128
    Reply from 10.1.0.4: bytes=32 time<1ms TTL=128
    Reply from 10.1.0.4: bytes=32 time<1ms TTL=128

    Ping statistics for 10.1.0.4:
        Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
    Approximate round trip times in milli-seconds:
        Minimum = 0ms, Maximum = 1ms, Average = 0ms
    ```

    3 番目の手順で *myVm1* VM での Windows ファイアウォール経由の ICMP を許可したため、*myVm1* から応答を受信します。

1.  *myVm2* へのリモート デスクトップ接続を閉じます。


| 警告：続行する前に、このラボで使用したすべてのリソースを削除する必要があります。  **Azure Portal** でこれを行うには、**リソース グループ** をクリックします。  作成したリソース グループを選択します。  リソース グループ ブレードで、**リソース グループを削除** をクリックし、リソース グループ名を入力して、**削除** をクリックします。  作成した可能性のある追加のリソース グループに対してプロセスを繰り返します。**これを行わないと、他のラボで問題が発生する可能性があります。** |
| --- |

**結果**：これで、このラボを完了しました。
