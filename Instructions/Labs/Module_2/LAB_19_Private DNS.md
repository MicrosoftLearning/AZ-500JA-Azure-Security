---
lab:
    title: 'ラボ 19 - プライベート DNS'
    module: 'モジュール 2 - プラットフォーム保護を実装する'
---

# モジュール 2：ラボ 19 - プライベート DNS


**シナリオ**

DNS ゾーンは特定のドメインの DNS レコードをホストするために使用されます。Azure DNS でドメインのホストを開始するには、そのドメイン名用に DNS ゾーンを作成します。ドメインの各 DNS レコードは、この DNS ゾーン内に作成されます。プライベート DNS ゾーンを仮想ネットワークに公開するには、ゾーン内のレコードを解決できる仮想ネットワークのリストを指定します。  これらは *リンクされた* 仮想ネットワークと呼ばれます。自動登録が有効になっている場合、Azure DNS は、仮想マシンが作成、IP アドレスを変更、または削除されるたびにゾーン レコードも更新します。

このラボでは、次の方法を学習します。

> * DNS ゾーンを作成する
> * 仮想ネットワークを作成する
> * 仮想ネットワークをリンクする
> * 仮想マシンのテストを作成する
> * 追加の DNS レコードを作成する
> * プライベート ゾーンをテストする



## 演習 1：Azure portal で新しい Azure DNS Private Zone を作成します。

### タスク 1：DNS ゾーンを作成する


次の例では、**MyAzureResourceGroup** というリソース グループに、**private.contoso.com** という DNS ゾーンを作成します。

DNS ゾーンにはドメインの DNS エントリが含まれています。Azure DNS でドメインのホストを開始するには、そのドメイン名用に DNS ゾーンを作成します。


1.  ポータル検索バーで、検索テキストボックスに **プライベート DNS ゾーン** を入力して、**Enter** を押します。
1.  **プライベート DNS ゾーン** を選択します。
2.  **プライベート DNS ゾーンを作成する** を選択します。

1.  **プライベート DNS ゾーンを作成する** ページで、次の値を入力または選択します。

   - **リソース グループ**：**新規作成** を選択し、*MyResourceGroup* と入力して、**OK** を選択します。Azure サブスクリプション内で一意となるリソース グループ名を使用してください。 
   -  **名前**: この例では *private.contoso.com* と入力します。
</br>   
1.  **リソース グループの場所** については、**米国中西部** を選択します。

1.  **「確認および作成」** を選択します。

1.  **作成** を選択します。

ゾーンの作成には数分かかることがあります。

### タスク 2：仮想ネットワークを作成する

1.  ポータルページの左上で、**リソースを作成する** を選択してから、**ネットワーク** を選択し、次に **仮想ネットワーク** を選択します。

2.  **名前** については、**myAzureVNet** を入力します。
3.  **リソース グループ** については、**MyAzureResourceGroup** を選択します。
4.  **場所** については、**米国東部** を選択します。
5.  他のデフォルト値を受け入れて、**作成** を選択します。

### タスク 3：仮想ネットワークをリンクする


プライベート DNS ゾーンを仮想ネットワークにリンクするには、仮想ネットワークリンクを作成します。


1.  **MyAzureResourceGroup** リソース グループを開き、**private.contoso.com** プライベートゾーンを選択します。

2.  左側のペインで、**仮想ネットワークリンク** を選択します。
3.  **「追加」** を選択します。
4.  **myLink** を **リンク名** に入力します。
5.  **仮想ネットワーク** については、**myAzureVNet** を選択します。
6.  **自動登録を有効にする** チェックボックスを選択します。
7.  **OK** を選択します。

     ![スクリーンショット](../Media/Module-2/1baf1a71-3ab4-4379-9b1c-d7358ec70a78.png)

### タスク 4：仮想マシンのテストを作成する


次に、プライベート DNS ゾーンをテストできるように 2 つの仮想マシンを作成します。


1.  ポータルページの左上で、**リソースを作成する** を選択してから、**Windows Server 2016 Datacenter** を選択します。

1.  **MyAzureResourceGroup** をリソース グループに選択します。
1.  **myVM01** -  を仮想マシンの名前に入力します。
1.  **米国東部** を **リージョン** に選択します。
1.  管理者のユーザー名に **LocalAdmin** を入力します。
2.  パスワードに **Pa55w.rd1234** と入力し、パスワードを確認します。

5.  **パブリック受信ポート** については、**選択したポートを許可** を選択してから、**RDP（3389）** を **受信ポートを選択** に選択します。
10.  ページの他のデフォルトを受け入れてから、**次：ディスク >** をクリックします。
11.  **ディスク** ページでデフォルトを受け入れてから、**次：ネットワーク >** をクリックします。
1.  **myAzureVNet** が仮想ネットワークに選択されていることを確認します。
1.  ページの他のデフォルトを受け入れてから、**次：管理 >** を選択します。
2.  **ブート診断** については、**オフ** を選択し、他のデフォルトを受け入れてから、**レビュー + 作成** を選択します。
1.  設定をレビューしてから、**作成** をクリックします。

1.  これらの手順を繰り返して、**myVM02** という別の仮想マシンを作成します。

両方の仮想マシンが完了するまで数分かかります。

### タスク 5：追加の DNS レコードを作成する


次の例では、DNS ゾーン **private.contoso.com** で、リソース グループ **MyAzureResourceGroup** で **db** という相対名でレコードを作成します。レコード セットの完全修飾名は **db.private.contoso.com** です。レコード タイプは「A」で、IP アドレスは **myVM01** となります。


1.  **MyAzureResourceGroup** リソース グループを開き、**private.contoso.com** プライベートゾーンを選択します。

2.  **+ レコード セット** を選択します。
3.  **名前** については、**db** と入力します。
4.  **IP アドレス** については、**myVM01** として表示される IP アドレスを入力します。これは、仮想マシンの起動時に自動登録される必要があります。
5.  **OK** を選択します。

### タスク 6：プライベート ゾーンをテストする


これで、**private.contoso.com** プライベート ゾーンについての名前解決をテストできます。

ping コマンドを使用して、名前解決をテストできます。そのため、両方の仮想マシンでファイアウォールを構成して、受信 ICMP パケットを許可します。


1.  myVM01 に接続し、管理者権限で Windows PowerShell ウィンドウを開きます。

2.  次のコマンドを実行します。

       ```powershell
       New-NetFirewallRule -DisplayName "Allow ICMPv4-In" -Protocol ICMPv4
       ```

1.  myVM02 については繰り返します。

### タスク 7：名前で VM を ping する

1.  myVM02 Windows PowerShell コマンドプロンプトから、自動的に登録されたホスト名を使用して myVM01 に ping を実行します。

       ```cli
       ping myVM01.private.contoso.com
       ```
   
    次のような出力が表示されるはずです。

    ```cli
    Pinging myvm01.private.contoso.com [10.2.0.4] with 32 bytes of data:
    Reply from 10.2.0.4: bytes=32 time<1ms TTL=128
    Reply from 10.2.0.4: bytes=32 time=1ms TTL=128
    Reply from 10.2.0.4: bytes=32 time<1ms TTL=128
    Reply from 10.2.0.4: bytes=32 time<1ms TTL=128
    ```
   
2.  これで、以前に作成した **db** 名に ping を実行します。
   
       ```cli
       ping db.private.contoso.com
       ```
       次のような出力が表示されるはずです。
   
       ```cli
       PS C:\> ping db.private.contoso.com

       Pinging db.private.contoso.com [10.2.0.4] with 32 bytes of data:
       Reply from 10.2.0.4: bytes=32 time<1ms TTL=128
       Reply from 10.2.0.4: bytes=32 time<1ms TTL=128
       Reply from 10.2.0.4: bytes=32 time<1ms TTL=128
       Reply from 10.2.0.4: bytes=32 time<1ms TTL=128

       Ping statistics for 10.2.0.4:
           Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
       Approximate round trip times in milli-seconds:
           Minimum = 0ms, Maximum = 0ms, Average = 0ms
       PS C:\>
       ```


| 警告：続行する前に、このラボで使用したすべてのリソースを削除する必要があります。  **Azure Portal** でこれを行うには、**リソース グループ** をクリックします。  作成したリソース グループを選択します。  リソース グループ ブレードで、**リソース グループを削除** をクリックし、リソース グループ名を入力して、**削除** をクリックします。  作成した可能性のある追加のリソース グループに対してプロセスを繰り返します。**これを行わないと、他のラボで問題が発生する可能性があります。** |
| --- |

**結果**：これで、このラボを完了しました。
